# Wagmi Hooks 生命周期和阶段

Wagmi 是一个用于与以太坊区块链交互的 React 库，提供了许多 hooks 来简化与以太坊的交互过程。以下是一个结构化的文档，按照生命周期阶段对各个 hook 进行了详细的划分。

## 1. 组件初始化阶段

这些 hooks 在 React 组件加载时首次触发，通常用于获取账户信息、网络信息、连接钱包等。

### 1.1 `useAccount`
- **功能**: 获取当前用户的以太坊账户信息。
- **触发时机**: 组件加载时触发，获取当前账户地址、是否已连接等信息。
- **返回值**:
  - `address`: 当前连接的账户地址。
  - `isConnected`: 布尔值，表示是否已连接钱包。

### 1.2 `useNetwork`
- **功能**: 获取当前网络的信息，例如网络名称、链 ID 等。
- **触发时机**: 组件加载时触发，获取当前连接的网络信息。
- **返回值**:
  - `chain`: 当前网络的信息（链 ID、网络名称等）。
  - `switchNetwork`: 切换网络的函数。

### 1.3 `useConnect`
- **功能**: 连接用户钱包，允许选择不同的钱包并进行连接。
- **触发时机**: 在组件加载时触发，用户手动连接钱包时。
- **返回值**:
  - `connect`: 用于连接钱包的函数。
  - `isConnected`: 是否已连接钱包。

### 1.4 `useDisconnect`
- **功能**: 断开与当前钱包的连接。
- **触发时机**: 当用户断开钱包连接时触发。
- **返回值**:
  - `disconnect`: 断开连接的函数。

### 1.5 `useEnsName`
- **功能**: 获取与当前账户地址关联的 ENS 名称。
- **触发时机**: 账户信息加载时触发，如果账户有绑定 ENS 名称，则返回该名称。
- **返回值**:
  - `ensName`: 账户的 ENS 名称。

### 1.6 `useChainId`
- **功能**: 获取当前连接的链 ID。
- **触发时机**: 组件加载时触发，获取当前链 ID。
- **返回值**:
  - `chainId`: 当前连接的链的 ID。

## 2. 网络和账户状态管理

这些 hooks 用于管理与以太坊网络和账户相关的状态，通常用于切换网络、更新账户信息等。

### 2.1 `useSwitchNetwork`
- **功能**: 用于切换以太坊网络。
- **触发时机**: 用户切换网络时调用。
- **返回值**:
  - `switchNetwork`: 用于切换网络的函数。

### 2.2 `useAccount`
- **功能**: 获取和更新用户的账户信息。
- **触发时机**: 当账户发生变化时重新触发。
- **返回值**:
  - `address`: 当前用户的以太坊地址。
  - `isConnected`: 是否已连接钱包。

## 3. 数据查询阶段

这些 hooks 用于查询和获取链上的数据，比如余额、代币余额和交易历史等。

### 3.1 `useBalance`
- **功能**: 获取指定账户的以太坊余额。
- **触发时机**: 在组件加载时触发，并在余额变化时自动更新。
- **返回值**:
  - `data`: 账户余额。
  - `isLoading`: 是否正在加载。
  - `error`: 错误信息。

### 3.2 `useToken`
- **功能**: 获取指定 ERC-20 代币的余额。
- **触发时机**: 在组件加载时触发，查询指定代币的余额。
- **返回值**:
  - `data`: 代币余额。
  - `isLoading`: 是否正在加载。
  - `error`: 错误信息。

### 3.3 `useTransactions`
- **功能**: 获取当前账户的交易历史。
- **触发时机**: 组件加载时触发，并在交易发生时自动更新。
- **返回值**:
  - `data`: 交易历史列表。
  - `isLoading`: 是否正在加载。
  - `error`: 错误信息。

### 3.4 `useContract`
- **功能**: 获取智能合约的实例，允许进行合约交互。
- **触发时机**: 初始化时调用，通常用于合约交互。
- **返回值**:
  - `contract`: 合约实例，用于执行合约方法。

## 4. 交易发送和监听阶段

这些 hooks 用于发送交易并监听交易的状态，帮助管理交易的生命周期。

### 4.1 `useSendTransaction`
- **功能**: 发送交易到以太坊网络。
- **触发时机**: 用户发起交易时触发。
- **返回值**:
  - `sendTransaction`: 用于发送交易的函数。
  - `isLoading`: 是否正在发送交易。
  - `error`: 错误信息。

### 4.2 `useWaitForTransaction`
- **功能**: 等待交易被确认并监听交易的状态。
- **触发时机**: 当交易已发送后，调用该 hook 来等待并监听交易的状态。
- **返回值**:
  - `data`: 交易的详细信息。
  - `isLoading`: 是否正在等待交易确认。
  - `error`: 错误信息。

## 5. 状态更新与组件卸载阶段

这些 hooks 在状态更新时触发，通常会在交易完成、账户切换或网络变化时重新渲染组件。

### 5.1 `useTransaction`
- **功能**: 跟踪交易的状态和信息。
- **触发时机**: 交易状态变化时触发。
- **返回值**:
  - `data`: 当前交易的状态和信息。
  - `isLoading`: 是否正在加载交易状态。
  - `error`: 错误信息。

### 5.2 `useBalance`, `useToken`, `useTransaction` 状态更新
- **功能**: 当账户余额、代币余额或交易状态发生变化时，自动更新组件。
- **触发时机**: 状态变化时触发，通常用于余额或交易完成后。
- **返回值**:
  - 更新后的余额或交易信息。

---

## 时间线总结

1. **组件初始化阶段**:
   - `useAccount`, `useNetwork`, `useConnect`, `useDisconnect`, `useEnsName`, `useChainId` 在组件挂载时触发，获取账户和网络信息。
   
2. **网络和账户状态管理**:
   - `useSwitchNetwork`, `useAccount` 用于处理账户信息和网络切换。

3. **数据查询阶段**:
   - `useBalance`, `useToken`, `useTransactions`, `useContract` 用于查询链上数据（余额、交易历史等）。

4. **交易发送和监听阶段**:
   - `useSendTransaction`, `useWaitForTransaction` 用于发送交易并监听交易的状态。

5. **状态更新与组件卸载阶段**:
   - `useTransaction`, `useBalance`, `useToken` 等在状态变化时触发，重新渲染组件。

---

通过这个文档，你可以清晰地了解 `wagmi` 库中的 hooks 在不同生命周期阶段的作用和使用时机。如果你需要更详细的使用示例或者具体代码，欢迎进一步询问。
